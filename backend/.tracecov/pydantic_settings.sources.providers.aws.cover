    1: from __future__ import annotations as _annotations  # important for BaseSettings import to work
       
    1: import json
    1: from collections.abc import Mapping
    1: from typing import TYPE_CHECKING
       
    1: from ..utils import parse_env_vars
    1: from .env import EnvSettingsSource
       
    1: if TYPE_CHECKING:
>>>>>>     from pydantic_settings.main import BaseSettings
       
       
    1: boto3_client = None
    1: SecretsManagerClient = None
       
       
    1: def import_aws_secrets_manager() -> None:
           global boto3_client
           global SecretsManagerClient
       
>>>>>>     try:
>>>>>>         from boto3 import client as boto3_client
>>>>>>         from mypy_boto3_secretsmanager.client import SecretsManagerClient
>>>>>>     except ImportError as e:  # pragma: no cover
>>>>>>         raise ImportError(
>>>>>>             'AWS Secrets Manager dependencies are not installed, run `pip install pydantic-settings[aws-secrets-manager]`'
>>>>>>         ) from e
       
       
    2: class AWSSecretsManagerSettingsSource(EnvSettingsSource):
    1:     _secret_id: str
    1:     _secretsmanager_client: SecretsManagerClient  # type: ignore
       
   11:     def __init__(
               self,
    1:         settings_cls: type[BaseSettings],
    1:         secret_id: str,
    2:         region_name: str | None = None,
    2:         endpoint_url: str | None = None,
    2:         case_sensitive: bool | None = True,
    2:         env_prefix: str | None = None,
    2:         env_nested_delimiter: str | None = '--',
    2:         env_parse_none_str: str | None = None,
    2:         env_parse_enums: bool | None = None,
    1:     ) -> None:
>>>>>>         import_aws_secrets_manager()
>>>>>>         self._secretsmanager_client = boto3_client('secretsmanager', region_name=region_name, endpoint_url=endpoint_url)  # type: ignore
>>>>>>         self._secret_id = secret_id
>>>>>>         super().__init__(
>>>>>>             settings_cls,
>>>>>>             case_sensitive=case_sensitive,
>>>>>>             env_prefix=env_prefix,
>>>>>>             env_nested_delimiter=env_nested_delimiter,
>>>>>>             env_ignore_empty=False,
>>>>>>             env_parse_none_str=env_parse_none_str,
>>>>>>             env_parse_enums=env_parse_enums,
               )
       
    1:     def _load_env_vars(self) -> Mapping[str, str | None]:
>>>>>>         response = self._secretsmanager_client.get_secret_value(SecretId=self._secret_id)  # type: ignore
       
>>>>>>         return parse_env_vars(
>>>>>>             json.loads(response['SecretString']),
>>>>>>             self.case_sensitive,
>>>>>>             self.env_ignore_empty,
>>>>>>             self.env_parse_none_str,
               )
       
    1:     def __repr__(self) -> str:
>>>>>>         return (
>>>>>>             f'{self.__class__.__name__}(secret_id={self._secret_id!r}, '
>>>>>>             f'env_nested_delimiter={self.env_nested_delimiter!r})'
               )
       
       
    1: __all__ = [
    1:     'AWSSecretsManagerSettingsSource',
       ]
